## 다루는 내용

## 1단계 문제 이해 및 설계 범위 확정

질문할 때 요구사항을 이해하고 모호함을 해소하는 데 초점을 맞추자.

- ex
  Q: ID는 어떤 특성을 갖나요?
  A: 유일해야 하고, 정렬 가능해야 한다.
  Q: 새로운 레코드에 붙일 ID는 항상 1만큼 큰 값이어야 하나요?
  A: ID의 값은 시간이 흐름에 따라 커질 테지만, 언제나 1씩 증가한다고 보장할 순 없다. 다만 확실한 것은, 아침에 만든 ID보다는 저녁에 만든 ID가 큰 값을 가져야 한다.
  Q: ID는 숫자로만 구성되나요?
  A: 그렇다.
  Q: 시스템 규모는 어느 정도 일까요?
  A: 초당 10,000 ID를 생성할 수 있어야 한다.
  ***
  정리하자면
  - ID는 유일해야 한다.
  - ID는 숫자로만 구성되어야 한다.
  - ID는 64비트로 표현될 수 있는 값이어야 한다.
  - ID는 발급 날짜에 따라 정렬 가능해야 한다.
  - 초당 10,000개의 ID를 만들 수 있어야 한다.

## 2단계 개략적 설계안 제시 및 동의 구하기

### 다중 마스터 복제

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/440ca016-b2bb-4b23-9715-d6e87f7d0da2/c60380ed-7d84-4d00-b94f-84a26cc6e16e/Untitled.png)

DB의 auto_increment 기능 활용 (단, ID의 값을 구할 때 1만큼 증가가 아니라, k만큼 증가)

- 여러 데이터 센터에 걸쳐 규모를 늘리기 어렵다.
- ID의 유일성은 보장되겠지만 그 값이 시간 흐름에 맞추어 커지도록 보장할 수는 없다.
- 서버를 추가하거나 삭제할 때도 잘 동작하도록 만들기 어렵다.

### UUID

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/440ca016-b2bb-4b23-9715-d6e87f7d0da2/3e5b622d-b11b-4eb6-82d9-8a0e61fd78b4/Untitled.png)

컴퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위한 128비트짜리 수.

충돌 가능성이 지극히 낮다.

- UUID를 만드는 것은 단순하다.
- 각 서버가 자기가 쓸 ID를 알아서 만드는 구조이므로 규모 확장도 쉽다.
- 128비트로 길다.
- 시간순으로 정렬 불가하다.
- ID에 숫자 아닌 값이 포함된다.

### 티켓 서버

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/440ca016-b2bb-4b23-9715-d6e87f7d0da2/f3f14944-9550-4b60-b479-2a054b282d8f/Untitled.png)

auto_incrment 기능을 갖춘 데이터 서버, 즉 티켓 서버를 중앙 집중형으로 하나만 사용하는 것이다.

- 유일성이 보장되는 오직 숫자로만 구성된 ID를 쉽게 만들 수 있다.
- 구현하기 쉽고, 중소 규모 애플리케이션에 적합하다.
- 티켓 서버가 SPOF가 된다. 이 문제를 피하기 위해 티켓 서버를 여러개 둘 경우, 데이터 동기화 문제가 발생한다.

### 트위터 스노플레이크 접근법

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/440ca016-b2bb-4b23-9715-d6e87f7d0da2/bb12418c-0edc-47c8-8bff-bf9a20bbc382/Untitled.png)

쓰임새

- 사인 비트(1비트)
- 타임스탬프(41비트)
- 데이터센터 ID(5비트)
- 서버 Id(5비트)
- 일려번호(12비트)

## 상세 설계

데이터센터 ID, 서버 ID는 시스템이 시작할 때 결정되며, 운영 중에 바뀌지 않는다.

## 마무리

- 시계 동기화: ID 생성 서버들이 전부 같은 시계로 가정하였지만, 하나의 서버가 여러 코어에서 실행될 경우 유효하지 않을 수 있다. → NTP가 문제해결 방법의 보편적인 수단
-
