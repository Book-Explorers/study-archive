# 1단계) 문제 이해 및 설계 범위 확정

- URL 단축 : 주어진 긴 URL을 훨씬 짧게 줄인다.
- URL 리다이렉션: 축약된 URL로 HTTP 요청이 오면 원래 URL로 안내한다.
- 높은 가용성과 규모 확장성, 그리고 장애 감내가 요규된다.

# **2단계) 개략적 설계안 제시 및 동의 구하기**

## API 엔드포인트

## URL 리다이렉션

단축 URL을 받은 서버는 그 URL을 원래 URL로 바꾸어서 301 응답의 Location 헤더에 넣어 반환한다.

- 301 Permanently Moved: 이 응답은 해당 URL에 대한 HTTP 요청의 처리 책임이 영구적으로 Location 헤더에 반환된 URL로 이전되었다는 응답이다. **영구적으로** 이전되었으니 브라우저는 이 응답을 캐시한다. 
→ 서버 부하를 줄이는 것이 중요할 때 사용
- 302 Found: 이 응답은 주어진 URL로의 요청이 **일시적으로** Location 헤더가 지정하는 URL에 의해 처리되어야 한다는 응답이다. 따라서 클라이언트의 요청은 언제나 단축 URL 서버에 먼저 보내진 후에 원래 URL로 리다이렉션 되어야 한다.
→ 트래픽 분석이 중요할 때 사용(클릭 발생률, 발생 위치 추적)

## URL 단축 플로

- 입력으로 주어지는 긴 URL이 다른 값이면 해시 값도 달라야 한다.
- 계산된 해시 값은 원래 입력으로 주어졌던 긴 URL로 복원될 수 있어야 한다.

# 3단계) 상세 설계

## **데이터 모델**

해시 테이블은 메모리가 유한하고 비싸기 때문에 실제 시스템에서 사용하는 것은 어렵다.

더 나은 방법은 관계형 데이터 베이스에 저장하는 것 <단축 URL, 원래 URL>

## **해시 함수**

해시 함수는 원래 URL을 단축 URL로 변환하는 데 쓰인다.

### **해시 값 길이**

0~9 + a-z + A-Z = 10 + 26 + 26 = 62

62^n > 목표 데이터 용량

### **해시 후 충돌 해소**

CRC32, MD5, SHA-1

해시 값에서 처음 7개 글자만 사용하고, 충돌할 경우 충돌이 해소될 때까지 사전에 정한 문자열을 해시값에 덧붙인다.

단축 URL을 생성할 때 한 번 이상 데이터베이스 질의를 해야 하므로 오버헤드가 크다.

### **base-62 변환**

단축 URL 길이가 가변적, 전역적 유일성 보장 ID 생성기 필요

## **URL 단축기 상세 설계**

p.136

## **URL 리디렉션 상세 설계**

캐시를 먼저 조회하고, 데이터가 없으면 RDB 조회 후 리디렉션

# **4단계) 마무리**

- 처리율 제한 장치
- 웹 서버의 규모 확장
- 데이터베이스의 규모 확장
- 데이터 분석 솔루션
- 가용성, 데이터 일관성, 안정성
