## 다루는 내용

- 목의 가치를 극대하기
- 목을 스파이로 교체하기
- 목 처리에 대한 모범 사례

**_시스템의 끝에 있다?_**

- 일종의 소프트웨어 구성 요소가 시스템의 끝에서 동작한다는 것으로 사용자와 상호작용하거나 외부 시스템과 통신(직접적으로 상호작용)하는 부분을 의미합니다.
- ex) 디스패처 서블릿, API 엔드포인트

### **1. 시스템 끝에서의 상호 작용 검증**

- 목을 활용하여 컨트롤러와 비관리 의존성 사이의 타입 사슬에서 마지막 고리를 처리합니다.
- 이를 통해 회귀 방지와 리팩터링 내성이 향상됩니다.

### **2. 목과 스파이의 활용**

- 목과 스파이는 같은 목적을 수행하는 테스트 대역입니다.
- 목은 검증에, 스파이는 실제 동작에 사용됩니다.
- 시스템 끝에 있는 클래스에 대해서는 스파이가 목보다 유용합니다.
- 스파이를 통해 테스트를 작성하면 제품 코드에 의존하지 않게 됩니다. 테스트는 감시자의 역할로 모든 것을 재확인합니다. 그로 인해 테스트 코드가 제품 코드의 변경에 덜 민감하게 되므로 유지보수와 리팩토링이 더 수월해집니다.

### 3. 올바른 목 사용

- 목은 `통합테스트` 에만 사용하고, 단위테스트에는 사용하지 않습니다.
- 비관리 의존성에만 목을 적용합니다.
- 시스템 끝에 있는 의존성에 대해 상호작용 검증합니다.

### **4. 하위 호환성 요구사항 고려**

- 모든 비관리 의존성에 하위 호환성이 동일한 수준으로 필요하지 않습니다.
- 상호작용하는 객체의 존재 여부와 전달하는 정보만 검증하면 됩니다.

### **5. 목의 수와 사용**

- 테스트에서 사용된 목의 수는 비관리 의존성의 수에 따라 달라집니다.
- 예상되는 호출과 예상치 못한 호출을 확인하고, 보유 타입만 목으로 처리해야 합니다.
  - 서드파티 라이브러리 위에 항상 어댑터를 작성하고 기본 타입 대신 어댑터를 목으로 처리합니다.
  - 프로세스 내부 의존성은 적용하지 않는다.
