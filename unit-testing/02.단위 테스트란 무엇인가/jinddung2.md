b# **2. 단위 테스트의 두 분파: 고전파와 런던파**

## **사전 지식**

### **단위 테스트의 정의**

- 단일 동작 단위를 검증하고,
- 빠르게 수행되며,
- 다른 테스트와 별도로 처리하는 것이다. (=격리된 방식으로 처리하는 자동화된 테스트)

### **단위테스트를 하는 이유**

- 코드의 특정 부분이 예상대로 동작하는지 확인하는 것.

## **2.0 의존성 종류 및 특징**

- 공유 의존성
  - 대상: 고전파, 런던파에서 테스트 대역으로 교체 가능한 대상.
  - 위치: 거의 항상 프로세스 외부에 위치하지만 항상 외부에 있지는 않음.
  - 통신 수단: 테스트 간에 통신이 가능해야 함. 의존성 내부 상태 수정 시 통신이 이뤄짐.
- 비공개 의존성
  - 변경 가능한 의존성
    - 대상: 런던파에서 테스트 대역으로 교체 가능한 대상.
    - 특징: 공유하지 않으면서 내부에서 변경 가능한 의존성.
  - 값 객체 (불변 객체 혹은 값):
    - 특징: 불변성을 유지하며 내부 수정이 불가능한 의존성.
- 프로세스 외부 의존성
  - 불변 의존성
    - 특징: 외부에 위치하면서 내부 수정이 불가능한 의존성.
    - 실행 컨텍스트 영향: 서로 실행 컨텍스트에 영향을 주지 않음.
  - 실무에서의 활용
    - 공유 의존성보다는 드물지만, 특정 상황에서 유용하게 활용 가능.
    - 프로세스 외부가 아닌 공유 의존성은 현실에서 거의 없으며, 테스트 용이성을 고려해 설계하는 것이 일반적.

## **2.1 격리 문제와 테스트 대상 단위**

격리는 테스트 대상 시스템에서 **협력자를 어떻게 다루는지에 대한 차이**로 나뉜다.

런던파는 테스트 대상 단위를 **단일 클래스**로 간주하고, **불변 의존성을 제외한 모든 의존성을 테스트 대역으로 대체**해야 합니다. 이는 코드 단위에 집중하고, 서로 연결된 클래스의 그래프가 커져도 테스트하기 쉽게 합니다.

고전파는 테스트 대상 단위를 **단일 동작 단위**로 간주하고, **공유 의존성만을 테스트 대역으로 대체**해야 합니다. 이는 동작 단위에 중점을 두고, 과도한 명세 문제를 피할 수 있습니다.

> 과도한 명세 문제란? </br>
> 주로 고전파에서 발생하는 문제로, 테스트가 특정 구현 세부 사항에 과도하게 결합되는 경우를 나타냅니다. 즉, 단위 테스트가 실제 코드의 내부 동작 방식과 매우 밀접하게 연결되어 있다는 것을 의미합니다. </br>

과도한 명세로 다음과 같은 상황이 발생할 수 있습니다.

1. 구현 변경에 대한 취약성: 실제 코드를 변경할 때 테스트도 함께 수정해야 할 필요가 있습니다. 이로 인해 구현의 변경에 대한 유연성이 감소하고, 유지보수가 어려워집니다.
2. 테스트의 재사용 어려움: 특정 구현과 밀접하게 결합된 테스트는 다른 부분에서 재사용하기 어려울 수 있습니다. 즉, 동작 단위가 아닌 구현 단위로 테스트가 작성되어 있기 때문에 다른 동작에서 활용하기 어렵다는 것을 의미합니다.
3. 유연성의 부족: 테스트가 특정 구현에 매우 의존적이면, 새로운 요구사항이나 변경사항에 대한 대응이 더욱 어려워집니다.

## **2.2 단위 테스트의 런던파와 고전파**

- 고전파
  - 작은 동작 단위를 테스트.
  - 빠르게 수행.
  - 다른 테스트와 별도로 처리.
- 런던파
  - 단일 클래스를 단위로 여김.
  - 입자성이 좋음.
  - 상호 연결된 클래스의 그래프에 대한 테스트 용이성.

|        | 격리 주체   | 단위의 크기                  | 테스트 대역 사용 대상      |
| ------ | ----------- | ---------------------------- | -------------------------- |
| 런던파 | 단위        | 단일 클래스                  | 불변 의존성 외 모든 의존성 |
| 고전파 | 단위 테스트 | 단일 클래스 또는 클래스 세트 | 공유 의존성                |

## **2.3 런던파를 중심으로 고전파와 비교**

**런던파의 이점**

- 좋은 입자성: 런던파는 테스트가 세밀하고, 한 번에 한 클래스만 확인하여 좋은 입자성을 제공합니다. 이는 단위 테스트에서 단위를 구성하는 방식에 대한 논쟁에서 나온 것으로, 런던파는 단위테스트 단위를 클래스로 간주합니다.

- 테스트하기 쉬운 클래스 그래프: 서로 연결된 클래스의 그래프가 커져도 테스트하기 쉽습니다. 이는 모든 협력자가 테스트 대역으로 대체되기 때문에 테스트 작성 시 걱정할 필요가 없습니다.

- 테스트 실패 시 명확한 기능 식별: 테스트가 실패하면 어떤 기능이 실패했는지 명확히 알 수 있습니다. 클래스의 협력자가 없으면 테스트 대상 클래스 외에 다른 것을 의심할 여지가 없으며, 이는 테스트를 더 직관적으로 만듭니다.

**고전파와의 차이**

- 입자성에 대한 의견 차이: 고전파에서는 단위 테스트가 동작 단위를 검증하는 것이 중요하다고 주장하지만, 런던파는 단위를 클래스로 간주하고, 입자성은 단일 동작 단위를 검증하는 데 더 중요하다고 주장합니다.

- 클래스 그래프 설정의 용이성: 런던파는 테스트 대상 시스템을 설정할 때 공유 의존성을 제거하고 전체 객체 그래프를 다시 생성하는 작업에 대한 걱정이 적다고 주장합니다. 이는 먼저 객체 그래프를 갖지 않게 하는 데 집중하는 것이 더 중요하다는 의견입니다.

- 오작동하는 클래스 디버깅 용이성: 고전파에서는 오작동하는 클래스를 참조하는 클라이언트를 대상으로 하는 테스트가 실패할 때 디버깅이 어려울 수 있지만, 런던파는 정기적으로 테스트를 실행하면 버그 원인을 쉽게 알아낼 수 있다고 주장합니다.

## **2.4 통합테스트**

- 런던파: 실제 협력자 객체를 사용하는 모든 테스트를 통합 테스트로 간주.
- 고전파: 단위 테스트 기준 중 하나 이상을 충족하지 못하면 통합 테스트로 간주.

### **2.4.1 엔드 투 엔드 테스트**

- 통합 테스트의 일부.
- 외부 종속성(전부 혹은 대다수)과 함께 어떻게 작동하는지 검증하는 테스트.
- 모든 외부 애플리케이션을 포함해 시스템을 최종 사용자의 관점에서 검증하는 것.
- 테스트 유지보수 측면에서 가장 비용이 많이 든다. </br>
  → 모든 단위테스트 및 통합 테스트 통과 후 빌드 프로세스 후반에 실행하는 편이 좋다.
