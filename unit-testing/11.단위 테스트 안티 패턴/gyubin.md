# 11. 단위 테스트 안티 패턴

## 11장에서 다루는 내용

- 비공개 메서드 단위 테스트
- 단위 테스트를 하기 위한 비공개 메서드 노출
- 테스트로 유출된 도메인 지식
- 구체 클래스 목 처리

## 비공개 메서드 단위 테스트

단위 테스트를 하려고 비공개 메서드를 노출하는 경우에는 식별할 수 있는 동작만 테스트해야하는 단위 테스트의 기본 원칙을 위반하는 것이다. 비공개 메서드를 노출하면 테스트가 구현 세부 사항과 결합되어 리팩토링 내성이 저하된다. 비공개 테스트를 직접 테스트하는 대신에 식별할 수 있는 동작안에서 간접적으로 테스트하는것이 좋다.

비공개 메서드가 너무 복잡해서 식별할 수 있는 동작으로 테스트하기에 충분한 커버리지를 얻을 수 없는 경우에는 별도의 클래스로 분리하여 별도의 테스트 코드를 작성하는 것이 바람직하다.

## 테스트로 유출된 도메인 지식

코드 베이스를 그대로 테스트 코드 내에서 사용하게 되면 테스트가 구현 세부 사항과 결합되며, 코드 베이스의 수정으로 인해 테스트가 실패하는 경우 실패 원인을 찾으려 하지 않고 코드 베이스를 복사해서 테스트 코드에 붙여넣기를 할 가능성이 높아지기 때문에 타당한 실패와 거짓 양성을 구별할 수 없다. 그렇기 때문에 테스트 코드에 코드 베이스를 그대로 사용하거나 특정 부분을 암시하면 안된다.

## 코드 오염

코드 베이스에 테스트를 위해 필요한 코드를 추가하는 것을 코드 오염이라 한다. 코드 오염의 문제는 테스트 코드와 코드 베이스가 혼재돼 유지비가 증가하는 것이다. 테스트를 위한 코드가 추가 되어야 한다면 interface를 활용하여 테스트를 위한 클래스와 코드 베이스를 위한 클래스를 만드는 것이 바람직하다.

## 구체 클래스를 목으로 처리하기

구체 클래스를 목으로 만들어 일부 기능을 재정의 해서 테스트하는 것인 안티 패턴이다. 이러한 상황에서는 일부 기능을 별도의 클래스로 분리하는 것이 바람직하다.

## 시간 처리하기

자바로 예를 들면 아래와 같은 클래스를 만들어 시간이 필요한 클래스에서 LocalDateTimeService를 의존하면 테스트 코드에서 LocalDateTimeService 목으로 쉽게 대체가 가능하기 때문에 원하는 테스트에서 원하는 시간을 쉽게 설정해줄 수 있다.

```java
public class LocalDateTimeService {
	public LocalDateTime getNow() {
		return LocalDateTime.now();
	}
	
	// 시간과 관련된 더 많은 코드들..
}
```
