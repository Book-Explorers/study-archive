## 다루는 내용

## 1단계) 문제 이해 및 설계 범위 확정

- 앱/ 웹 모두 지원
- 뉴스 피드 등록 / 뉴스 피드 구독
- 뉴스 피드는 최신순으로 표시
- 친구 등록 ≤ 5000명
- DAU 1000만
- 이미지나 비디오 등 미디어 파일 포함될 수 있음

## 2단계) 개략적 설계안 제시 및 동의 구하기

- 피드 발행: 사용자가 스토리를 포스티항하면 해당 데이터를 캐시와 데이터 베이스에 기록한다. 새 포스팅은 친구의 뉴스 피드에도 전송된다.
- 뉴스 피드 생성: 지면 관계상 뉴스 피드는 모든 친구의 포스팅을 시간 흐름 역순으로 모아서 만든다고 가정한다.

### 뉴스 피드 API

- 피드 발행 API → 포스트 저장 서비스, 포스트 전송 서비스, 알림 서비스

> 포스트 저장 서비스에
>
- 피드 읽기 API → 뉴스 피드 서비스, 뉴스 피드 캐시

## 3단계) 상세 설계

**피드 발행 흐름 상세 설계**

**웹 서버**

- 인증
- 처리율 제한

> 웹 서버라고 하나로 표현했지만, API Gateway 역할로 보임
>

**포스팅 전송(팬아웃) 서비스 →** 쓰기 시점에 팬아웃하는 모델

새로운 포스팅을 기록하는 시점에 뉴스 피드를 갱신하게 된다.

장점

- 뉴스 피드가 실시간으로 갱신되며, 친구 목록에 있는 사용자에게 즉시 전송된다.
- 뉴스 피드를 읽는 데 드는 시간이 짧아진다.

단점

- 친구가 많은 사용자의 경우 뉴스 피드를 갱신하는 데 많은 시간이 소요된다. (핫키 이슈)
- 서비스를 자주 이용하지 않는 사용자의 피드까지 갱신해야 하므로 컴퓨팅 자원이 낭비된다.

---

**읽기 시점에 팬아웃하는 모델**

피드를 읽어야 하는 시점에 뉴스 피드를 갱신한다.

장점

- 로그인하지 않으면 컴퓨팅 자원을 소모하지 않는다.
- 데이터를 친구에게 푸시하는 작업이 필요 없으므로 핫키 문제도 생기지 않는다.

단점

- 뉴스 피드를 읽는 데 많은 시간이 소요될 수 있다.

**피드 읽기 흐름 상세 설계**

**캐시 구조**

**4단계 마무리**

설계를 진행하고 기술을 선택할 때는 그 배경에 어떤 타협적 결정들이 있었는지 잘 이해하고 설명할 수 있어야 한다.

데이터베이스 규모 확장

- 수직적 규모 확장 vs 수평적 규모 확장
- SQL vs NoSQL
- 주-부 다중화
- 복제본에 대한 읽기 연산
- 일관성 모델
- 데이터베이스 샤딩
